# Pre-commit hooks configuration for BMCIS Knowledge MCP project
# Install hooks: pre-commit install
# Run manually: pre-commit run --all-files
# See https://pre-commit.com for more information

repos:
  # Standard pre-commit hooks
  - repo: https://github.com/pre-commit/pre-commit-hooks
    rev: v4.5.0
    hooks:
      - id: trailing-whitespace
        name: Trim trailing whitespace
        description: Removes trailing whitespace from files
        exclude: ^(\.venv|\.git|node_modules)
      - id: end-of-file-fixer
        name: Fix end of file
        description: Ensures files end with newline
        exclude: ^(\.venv|\.git|node_modules)
      - id: check-yaml
        name: Check YAML syntax
        description: Checks that YAML files parse as valid YAML
        args: [--unsafe]
        exclude: ^(\.venv|\.git)
      - id: check-json
        name: Check JSON syntax
        description: Checks that JSON files parse as valid JSON
        exclude: ^(\.venv|\.git|node_modules)
      - id: check-toml
        name: Check TOML syntax
        description: Checks that TOML files parse as valid TOML
        exclude: ^(\.venv|\.git)
      - id: check-merge-conflict
        name: Check for merge conflicts
        description: Prevents files with merge conflicts from being committed
      - id: check-added-large-files
        name: Check for added large files
        description: Prevents giant files from being committed
        args: [--maxkb=1000]
      - id: detect-private-key
        name: Detect private keys
        description: Detects presence of private keys

  # Black code formatter
  - repo: https://github.com/psf/black
    rev: 23.12.1
    hooks:
      - id: black
        name: Format code with Black
        description: Auto-formats Python code to comply with Black's style
        language_version: python3.11
        exclude: ^(\.venv|node_modules)

  # Ruff linter and import sorter
  - repo: https://github.com/astral-sh/ruff-pre-commit
    rev: v0.1.11
    hooks:
      - id: ruff
        name: Lint with Ruff
        description: Fast Python linter that enforces PEP 8 and more
        args: [--fix]
        exclude: ^(\.venv|node_modules)
      - id: ruff-format
        name: Format with Ruff
        description: Ruff's formatter (optional, black also used)
        exclude: ^(\.venv|node_modules)

  # MyPy type checking
  - repo: https://github.com/pre-commit/mirrors-mypy
    rev: v1.8.0
    hooks:
      - id: mypy
        name: Type check with MyPy
        description: Static type checker for Python
        args: [--strict, --ignore-missing-imports]
        additional_dependencies:
          - pydantic>=2.0.0
          - pydantic-settings>=2.0.0
          - psycopg[binary]>=3.1.0
          - pgvector>=0.2.0
          - types-setuptools
        exclude: ^(\.venv|node_modules)

  # Docstring coverage
  - repo: https://github.com/econchick/interrogate
    rev: 1.5.0
    hooks:
      - id: interrogate
        name: Check docstring coverage
        description: Checks for missing docstrings in public APIs
        args: [--vv, --fail-under=70, --ignore-init-method, --ignore-init-module]
        exclude: ^(\.venv|tests|node_modules)

# Configuration for CI/CD environments
default_stages: [commit]
fail_fast: false
